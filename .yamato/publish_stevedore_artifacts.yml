name: 'Publish 7za Stevedore artifacts'

agent:
  type: Unity::VM
  image: cds-ops/cds-ubuntu-18.04-base:stable
  flavor: b1.small
dependencies:
  - .yamato/build.yml#1003259
commands:
  - sudo DEBIAN_FRONTEND=noninteractive apt-get update -qy
  - sudo apt-get install -y p7zip-full p7zip-rar
  - 7z a producedbuilds/linux.7z Artifacts/Builds/Binaries/Linux/*
  - 7z a producedbuilds/mac.7z Artifacts/Builds/Binaries/Mac/*
  # Script needs the version string of the source artifact (which must match StevedoreUpload args).
  - ./stevedore-build-artifacts.sh "test_roslyn"
  - curl -sSo StevedoreUpload.exe "$STEVEDORE_UPLOAD_TOOL_URL"
  - mono StevedoreUpload.exe --repo=testing --version-len=11 --version="test_roslyn" producedbuilds/*
