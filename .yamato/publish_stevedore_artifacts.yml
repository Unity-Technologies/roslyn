publish:
  name: 'Publish 7za Stevedore artifacts, including source (GPL)'
  agent:
    type: Unity::VM
    image: cds-ops/cds-ubuntu-18.04-base:stable
    flavor: b1.small
  dependencies:
    - .yamato/build.yml
    - .yamato/set_exe_bit_linux.yml
    - .yamato/set_exe_bit_osx.yml
    - .yamato/produce_artifacts.yml
  commands:
    # Script needs the version string of the source artifact (which must match StevedoreUpload args).
    - ./stevedore-build-artifacts.sh "test_roslyn"
    - curl -sSo StevedoreUpload.exe "$STEVEDORE_UPLOAD_TOOL_URL"
    - mono StevedoreUpload.exe --repo=testing --version-len=12 --version="$GIT_REVISION" test/art/*
