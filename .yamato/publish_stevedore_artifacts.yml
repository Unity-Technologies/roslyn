name: 'Publish 7z Stevedore artifacts'

agent:
  type: Unity::VM
  image: cds-ops/cds-ubuntu-18.04-base:stable
  flavor: b1.small
dependencies:
  - .yamato/build.yml
commands:
  - apt-get install -y p7zip-full p7zip-rar
  # Script needs the version string of the source artifact (which must match StevedoreUpload args).
  - ./stevedore-build-artifacts.sh "$(echo "$GIT_REVISION"|cut -b1-12)"
  - curl -sSo StevedoreUpload.exe "$STEVEDORE_UPLOAD_TOOL_URL"
  - mono StevedoreUpload.exe --repo=testing --version-len=12 --version="$GIT_REVISION" producedbuilds/*
